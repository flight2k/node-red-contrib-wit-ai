<script type="text/x-red" data-template-name="wit-message">
    <div class="form-row">
        <label for="node-input-app"><i class="fa fa-globe"></i> Wit App</label>
        <input type="text" id="node-input-app">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</span></label>
        <input type="text" id="node-input-name">
    </div>
</script>

<script type="text/x-red" data-help-name="wit-message">
    <p>Return the meaning of a sentence</p>
    <p>Requires a message with the properties:</p>
    <ul>
       <li><code>msg.payload</code></li>
    </ul>
    <p><code>msg.payload</code> will be treated as a String</p>
</script>

<script type="text/javascript">
    RED.nodes.registerType('wit-message',{
        category: 'wit_ai',
        defaults: {
            name: {value:""},
            app: {type:"wit-app", required:true}
        },
        color:"#AAC9EC",
        inputs:1,
        outputs:1,
        icon: "wit.png",
        label: function() {
            return this.name||"wit message";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });
</script>

<script type="text/x-red" data-template-name="wit-action-out">
    <div class="form-row">
        <label for="node-input-app"><i class="fa fa-globe"></i> Wit App</label>
        <input type="text" id="node-input-app">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</span></label>
        <input type="text" id="node-input-name">
    </div>
</script>

<script type="text/x-red" data-help-name="wit-action-out">
    <p>TBD help about action responses</p>
</script>

<script type="text/javascript">
    RED.nodes.registerType('wit-action-out',{
        category: 'wit_ai',
        defaults: {
            name: {value:""},
            app: {type:"wit-app", required:true}
        },
        color:"#AAC9EC",
        inputs:1,
        outputs:0,
        icon: "wit.png",
        align: "right",
        label: function() {
            return this.name||"response";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });
</script>

<script type="text/x-red" data-template-name="wit-action-in">
    <div class="form-row">
        <label for="node-input-app"><i class="fa fa-globe"></i> Wit App</label>
        <input type="text" id="node-input-app">
    </div>
    <div class="form-row">
        <label for=""><i class="fa fa-tasks"></i> Type</span></label>
        <select id="wit-action-in-type-select" style="width: 73%">
            <option value="merge">Merge</option>
            <option value="say">Say</option>
            <option value="error">Error</option>
            <option value="action">Action</option>
        </select>
        <input type="hidden" id="node-input-actionType">
    </div>
    <div class="form-row action-row hidden" id="wit-action-row-action">
        <label for="node-input-ation"><i class="fa fa-function"></i> Action</label>
        <input type="text" id="node-input-action">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</span></label>
        <input type="text" id="node-input-name">
    </div>
</script>

<script type="text/x-red" data-help-name="wit-action-in">
    <p>TBD help about actions</p>
</script>

<script type="text/javascript">
    RED.nodes.registerType('wit-action-in',{
        category: 'wit_ai',
        defaults: {
            name: {value:""},
            app: {type:"wit-app", required:true},
            action: {value:""},
            actionType: {value:"action", required:true}
        },
        color:"#AAC9EC",
        inputs:0,
        outputs:1,
        icon: "wit.png",
        label: function() {
            if(this.name) {
                return this.name;
            } else if (this.actionType === "action") {
                return this.action;
            } else {
                return this.actionType||'wit action in';
            }
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {

            var actionType = this.actionType;
            if(actionType == null) {
                actionType = 'action';
            }
            $("#wit-action-in-type-select").change(function() {
                var val = $("#wit-action-in-type-select option:selected").val();
                if(val === 'action') {
                    $('#wit-action-row-action').show();
                } else {
                    $('#wit-action-row-action').hide();
                }
            });

            $("#wit-action-in-type-select option").filter(function() {return $(this).val() == actionType;}).attr('selected',true);

            $("#wit-action-in-type-select").change();
        },
        oneditsave: function() {
            var actionType = $("#wit-action-in-type-select option:selected").val();
            $("#node-input-actionType").val(actionType);
        }
    });
</script>

<script type="text/x-red" data-template-name="wit-app">
    <div class="form-row">
        <label for="node-config-input-name"><i class="fa fa-globe"></i> Name</label>
        <input type="text" id="node-config-input-name">
    </div>
    <div class="form-row">
        <label for="node-config-input-token"><i class="fa fa-tag"></i> Token</label>
        <input type="text" id="node-config-input-token">
    </div>
</script>

<script type="text/x-red" data-help-name="wit-app">
    <p>Help about the wit app</p>
</script>

<script type="text/javascript">
    RED.nodes.registerType('wit-app',{
        category: 'config',
        defaults: {
            name: {value:"My Wit App", required:true},
            token: {value:"",required:true}
        },
        label: function() {
            return this.name;
        }
    });
</script>
